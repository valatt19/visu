<!DOCTYPE html>
<html>
    <head>
        <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/topnav.css') }}">
        <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/location.css') }}">
        
        <script type = "text/javascript" src = "https://d3js.org/d3.v4.min.js"></script>

        <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/location.css') }}">
        <title>Disasters location</title>
    </head>
    <body>
        <div class="topnav">
            <a href="/">Home</a>
            <div class="search">
                <form action="/location/" method="GET">
                    <label for="lat">Latitude: </label>
                    <input type="number" step="0.0001" id="lat" name="lat">
                    <label for="long">Longitude: </label>
                    <input type="number" step="0.0001" id="long" name="long">
                    <input type="submit" value="Search">
                </form>
            </div>
        </div>

        <div class="summary">
           <h3>Summary</h3>

            <p>Volcanos: {{summary[0]}} <br />
                Earthquakes: {{summary[1]}} <br />
                Tsunamis: {{summary[2]}}</p>
            <!-- dispaly the damage only if define -->
            {% if info is defined and info|length %}
                <table>
                    <tr>
                        <th>Damage</th>
                        <th>Damage </th>
                    </tr>
                    {% for damage, number in info.items() %}
                        {% if damage == "damages" %}
                            <tr>
                                <td>{{ damage }}</td>
                                <td>{{ number }} M $</td>
                           </tr>
                        {% else %}

                            <tr>
                                <td>{{ damage }}</td>
                                <td>{{ number }}</td>
                            </tr>
                        {% endif %}

                    {% endfor %}
                </table>
            {% endif %}
        </div>

        <div class="visu" style="text-align:center">
            <h1>[ {{coord[0]}} ; {{coord[1]}} ]</h1>
            <div class="circles" style="text-align:center;">
                <svg width = "600" height = "600" style="border:2px solid black">
                    <g>
                        <image href="/static/img/nord.png" x=500 y=60 height="35" width="35" />
                    </g>
                    <g>
                        <circle style="fill: #ffffff" stroke="black" stroke-width="2" cx=300 cy=300 r=250></circle>
                    </g>
                    <g>
                        <text stroke="black" style="font-size: 12px" x=555 y=300>50km</text>
                    </g>
                    <g>
                        <circle style="fill: #ffffff" stroke="black" stroke-width="2" cx=300 cy=300 r=125></circle>
                    </g>
                    <g>
                        <text stroke="black" style="font-size: 12px" x=430 y=300>25km</text>
                    </g>
                    <g>
                        <circle style="fill: #ff0000" stroke="black" cx=300 cy=300 r=5></circle>
                    </g>

                    {% for e in events["earthquakes"] %}
                    <g class="pointer">
                        <image href="/static/img/icon_earthquake.png" x={{288+e["proj"][0]*5}} y={{288+e["proj"][1]*5}} height="25" width="25" onclick="showDetails('e','{{ loop.index }}')"/>
                    </g>
                    {% endfor %}


                    {% for e in events["tsunamis"] %}
                    <g class="pointer">
                        <text style="font-size: 25px" x={{290+e["proj"][0]*5}} y={{310+e["proj"][1]*5}} onclick="showDetails('t','{{ loop.index }}')">ðŸŒŠ</text>
                    </g>
                    {% endfor %}


                    {% for e in events["volcanos"] %}
                    <g class="pointer">
                        <text style="font-size: 25px" x={{290+e["proj"][0]*5}} y={{310+e["proj"][1]*5}} onclick="showDetails('v','{{ loop.index }}')">ðŸŒ‹</text>
                    </g>
                    {% endfor %}
                 </svg>

            </div>
            <div class="timeline">
            </div>
        </div>

        <div class="details">
            <h3>Details</h3>
            <div id="details">
                {% for e in events["earthquakes"] %}
                <div id="e{{loop.index}}" style="display:none">
                    {% for attribut, value in events["earthquakes"][loop.index-1].items() %}
                        {{ attribut }} : {{ value }}
                    {% endfor %}
                </div>
                {% endfor %}

                {% for e in events["tsunamis"] %}
                <div id="t{{loop.index}}" style="display:none">
                    {% for attribut, value in events["tsunamis"][loop.index-1].items() %}
                        {{ attribut }} : {{ value }}
                    {% endfor %}
                </div>
                {% endfor %}

                {% for e in events["volcanos"] %}
                <div id="v{{loop.index}}" style="display:none">
                    {% for attribut, value in events["volcanos"][loop.index-1].items() %}
                        {{ attribut }} : {{ value }}
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
        </div>

            <div class="detail">

        {% set value_id = 0 %}
            {% if events is defined and events|length > 3 %}
                <!--check is the event is a earthquakes -->
                {% set name_event = "earthquakes"  %}
                {% if name_event in events %}
                    {% for i in events[name_event] %}
                        {% if value_id in events["earthquakes"][i].values() %}
                            {% for attribut, value in events["earthquakes"][i].items() %}
                                 {{ attribut }} : {{ value }}
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                {% endif %}

                <!--check is the event is a volcanos -->
                {% set name_event = "volcanos" %}
                {% if name_event in events %}
                    {% for i in events[name_event] %}
                        {% if value_id in events[name_event][i].values() %}
                            {% for attribut, value in events[name_event][i].items() %}
                                 {{ attribut }} : {{ value }}
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                {% endif %}

                <!--check is the event is a volcanos -->
                {% set name_event = "tsunamis" %}
                {% if name_event in events %}
                    {% for i in events[name_event] %}
                        {% if value_id in events[name_event][i].values() %}
                            {% for attribut, value in events[name_event][i].items() %}
                                 {{ attribut }} : {{ value }}
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                {% endif %}

            {% endif %}

        </div>



        <script type="text/javascript" src="/static/js/details.js"></script>
    </body>
</html>